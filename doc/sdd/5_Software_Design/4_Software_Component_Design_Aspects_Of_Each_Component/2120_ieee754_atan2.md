### \_\_ieee754\_atan2 {#sec:component-ieee-atan2}

\begin{sffamily}\small
	\begin{center}
		\begin{tabularx}{\dimexpr\textwidth-1\tabcolsep}{p{2.3cm}X}
			Interface       & \texttt{double \_\_ieee754\_atan2(double y, double x)} \\ 
			
			Type & Internal Procedure    \\ 
			
			Files & \texttt{libm/math/e\_atan2.c}    \\ 
			
			Subordinates and Superiors &
			\raisebox{-1\height}{\includegraphics[]{./figure/Declaration-__ieee754_atan2.png}}    \\ 
			
			Purpose & 
			The internal \texttt{\_\_ieee754\_atan2} function shall return the arctangent of $\frac{y}{x}$. \newline
			This component does not implement software requirements by itself.    \\ 
			
			References & \texttt{\_\_ieee754\_atan2f} \ref{sec:component-ieee-atan2f}, \texttt{atan2} \ref{sec:component-atan2}, \texttt{atan} \ref{sec:component-atan}, \texttt{fabs} \ref{sec:component-fabs}    \\ 
		\end{tabularx}
	\end{center}
\end{sffamily}

#### Procedure Design

\begin{compactenum}
	\item Use the following constants throughout the implementation of the internal atan2:
	\begin{compactitem}
		\item $PI$ = \texttt{0x400921FB54442D18} (3.1415926535897931160)
		\item $PI_{lo}$ = \texttt{3CA1A62633145C07} (1.2246467991473531772 $\cdot 10^{-16}$)
		\item $PIo2$ = \texttt{0x3FF921FB54442D18} (1.5707963267948965580)
		\item $PIo4$ = \texttt{0x3FE921FB54442D18} (7.8539816339744827900 $\cdot 10^{-1}$)
	\end{compactitem}
	\item If x or y is \texttt{NaN}, return \texttt{NaN}.
	\item If x is 1, return the result of the call atan(y).
	\item Let $m = 2 \cdot sign_x + sign_y$, this is to have the signs of x and y in a single variable for use in switch-case clauses.
	\item If y is 0:
	\begin{compactenum}
		\item If m <= 1, return y.
		\item If m is 2, return $\pi = PI$, with inexact.
		\item Return $-\pi = -PI$, with inexact.
	\end{compactenum}
	\item If x is 0, return $\frac{\pi}{2} = PIo2$ with the sign of y, with inexact.
	\item If x is infinite:
	\begin{compactenum}
		\item If y is infinite:
		\begin{compactenum}
			\item If m is 0, return $\frac{\pi}{4} = PIo4$, with inexact.
			\item If m is 1, return $-\frac{\pi}{4} = -PIo4$, with inexact.
			\item If m is 2, return $\frac{3}{4}\pi = 3 \cdot PIo4$, with inexact.
			\item Return $-\frac{3}{4}\pi = -3 \cdot PIo4$, with inexact.
		\end{compactenum}
		\item If m is 0, return $0$.
		\item If m is 1, return $-0$.
		\item If m is 2, return $\pi = PI$, with inexact.
		\item Return $-\pi = -PI$, with inexact.
	\end{compactenum}
	\item If y is infinite, return $\frac{\pi}{2}$ with the sign of y, with inexact.
	\item If $|\frac{y}{x}|$ > $2^{60}$, let $z = PIo2 + 0.5 \cdot PI_{lo}$, and mask off all but the last bit of m.
	\item Else:
	\begin{compactenum}
		\item If $\frac{|y|}{x}$ < $-2^{-60}$ let $z = 0$.\footnote{This is an optimization which omits the call to fabs and atan as the result is so much smaller than $PI$ that the result has no significance to the final result (as m can only be 2 or 3 for negative x).}
		\item Else let $z = tan^{-1}|\frac{y}{x}|$, using the procedures atan and fabs.
	\end{compactenum}
	\item If m is 0, return $z$.
	\item If m is 1, return $-z$.
	\item If m is 2, return $PI-(z-PI_{lo})$.
	\item Return $(z-PI_{lo})-PI$.
\end{compactenum}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.6\textwidth]{./figure/Ieee_Atan2_Flowchart.pdf}
	\caption{Flowchart \_\_ieee754\_atan2}
	\label{fig:flowchart-ieee_atan2}
\end{figure}