### atan {#sec:component-atan}

\begin{sffamily}\small
	\begin{center}
		\begin{tabularx}{\dimexpr\textwidth-1\tabcolsep}{p{2.3cm}X}
			Interface       & \texttt{double atan(double x)} \\ 
			
			Type & Procedure    \\ 
			
			Files & \texttt{libm/math/s\_atan.c}    \\ 
			
			Subordinates and Superiors &
			\raisebox{-1\height}{\includegraphics[]{./figure/Declaration-atan.png}}    \\ 
			
			Purpose & The \texttt{atan} function shall return the arctangent of x. \newline
			This component implements the following software requirements:
			\begin{compactitem}
				\item REQ-ML-0600
				\item REQ-ML-0602
				\item REQ-ML-0610
				\item REQ-ML-0620
				\item REQ-ML-0621
			\end{compactitem}    \\ 
			
			References & \texttt{atanf} \ref{sec:component-atanf}, \texttt{\_\_ieee754\_atan2} \ref{sec:component-ieee-atan2}, \texttt{fabs} \ref{sec:component-fabs}    \\ 
		\end{tabularx}
	\end{center}
\end{sffamily}

#### Procedure Design

\begin{compactenum}
	\item If x is \texttt{NaN}, return \texttt{NaN}.
	\item Use the following constants throughout the implementation of atan:
	\begin{compactitem}
		\item $atan0.5_{hi}$ = \texttt{0x3FDDAC670561BB4F} (4.63647609000806093515 $\cdot 10^{-1}$)
		\item $atan0.5_{lo}$ = \texttt{0x3C7A2B7F222F65E2} (2.26987774529616870924 $\cdot 10^{-17}$)
		\item $atan1_{hi}$ = \texttt{0x3FE921FB54442D18} (7.85398163397448278999 $\cdot 10^{-1}$)
		\item $atan1_{lo}$ = \texttt{0x3C81A62633145C07} (3.06161699786838301793 $\cdot 10^{-17}$)
		\item $atan1.5_{hi}$ = \texttt{0x3FEF730BD281F69B} (9.82793723247329054082 $\cdot 10^{-1}$)
		\item $atan1.5_{lo}$ = \texttt{0x3C7007887AF0CBBD} (1.39033110312309984516 $\cdot 10^{-17}$)
		\item $atanInf_{hi}$ = \texttt{0x3FF921FB54442D18} (1.57079632679489655800)
		\item $atanInf_{lo}$ = \texttt{0x3C91A62633145C07} (6.12323399573676603587 $\cdot 10^{-17}$)
	\end{compactitem}
	\item If |x| > $2^{66}$, return $atanInf_{hi} + atanInf_{lo}$ (which represents $\frac{\pi}{2}$) with the sign of x.
	\item If |x| < $2^{-27}$, return x, with inexact.
	\item Use the identity $tan^{-1}(x) = -tan^{-1}(-x)$ to reduce x to positive.
	\item If x < $\frac{7}{16}$(\footnote{Test with \texttt{highword} < \texttt{0x3FDC0000}.}), use the identity
	\begin{align}
		tan^{-1}(x) &= x - \frac{x^3}{3} + \frac{x^5}{5} - \frac{x^7}{7} + ... \nonumber \\
		&= \sum\limits_{i=0}^{\infty} \frac{(-1)^i \cdot x^{2i+1}}{2i+1} \label{formula_atan_1}
	\end{align}
	to approximate atan rationally as\footnote{Use Horner's method for implementation}:
	\begin{align}
		atan(x) ={ }& x - x \cdot R(x) \label{formula_atan_2} \\
		R(x)    ={ }& A0 \cdot x^2 - A1 \cdot x^4 + A2 \cdot x^6 - A3 \cdot x^8 + A4 \cdot x^{10} - A5 \cdot x^{12} \nonumber \\
	            	&+ A6 \cdot x^{14} - A7 \cdot x^{16} + A8 \cdot x^{18} - A9 \cdot x^{20} + A10 \cdot x^{22} \label{formula_atan_3}
	\end{align}
	with
	\begin{compactitem}
		\item $A0$ = \texttt{0x3FD555555555550D} (3.33333333333329318027 $\cdot 10^{-1}$)
		\item $A1$ = \texttt{0xBFC999999998EBC4} (-1.99999999998764832476 $\cdot 10^{-1}$)
		\item $A2$ = \texttt{0x3FC24924920083FF} (1.42857142725034663711 $\cdot 10^{-1}$)
		\item $A3$ = \texttt{0xBFBC71C6FE231671} (-1.11111104054623557880 $\cdot 10^{-1}$)
		\item $A4$ = \texttt{0x3FB745CDC54C206E} (9.09088713343650656196 $\cdot 10^{-2}$)
		\item $A5$ = \texttt{0xBFB3B0F2AF749A6D} (-7.69187620504482999495 $\cdot 10^{-2}$)
		\item $A6$ = \texttt{0x3FB10D66A0D03D51} (6.66107313738753120669 $\cdot 10^{-2}$)
		\item $A7$ = \texttt{0xBFADDE2D52DEFD9A} (-5.83357013379057348645 $\cdot 10^{-2}$)
		\item $A8$ = \texttt{0x3FA97B4B24760DEB} (4.97687799461593236017 $\cdot 10^{-2}$)
		\item $A9$ = \texttt{0xBFA2B4442C6A6C2F} (-3.65315727442169155270 $\cdot 10^{-2}$)
		\item $A10$ = \texttt{0x3F90AD3AE322DA11} (1.62858201153657823623 $\cdot 10^{-2}$)
	\end{compactitem}
	\item If x < $\frac{11}{16}$(\footnote{Test with \texttt{highword} < \texttt{0x3FE60000}.}), use the identity $tan^{-1}(x) = tan^{-1}(\frac{1}{2}) + tan^{-1}(\frac{x-\frac{1}{2}}{1+\frac{x}{2}})$ to modify the approximation of atan as in formula \ref{formula_atan_3} to:
	\begin{align}
		z       &= \frac{2x - 1}{2 + x} \label{formula_atan_4} \\
		atan(x) &= tan^{-1}\Big(\frac{1}{2}\Big) + (z - z \cdot R(z)) \nonumber \\
       &= atan0.5_{hi} - ((z \cdot R(z) - atan0.5_{lo}) - z) \label{formula_atan_5}
	\end{align}
	\item If x < $\frac{19}{16}$(\footnote{Test with \texttt{highword} < \texttt{0x3FF30000}.}), use the identity $tan^{-1}(x) = tan^{-1}(1) + tan^{-1}(\frac{x-1}{1+x}) = \frac{\pi}{4} + tan^{-1}(\frac{x-1}{1+x})$ to modify the approximation of atan to:
	\begin{align}
		z       &= \frac{x - 1}{x + 1} \label{formula_atan_6} \\
		atan(x) &= \frac{\pi}{4} + (z - z \cdot R(z)) \nonumber \\
		&= atan1_{hi} - ((z \cdot R(z) - atan1_{lo}) - z) \label{formula_atan_7}
	\end{align}
	\item If x < $\frac{39}{16}$(\footnote{Test with \texttt{highword} < \texttt{0x40038000}.}), use the identity $tan^{-1}(x) = tan^{-1}(\frac{3}{2}) + tan^{-1}(\frac{x-\frac{3}{2}}{1+\frac{3}{2}x})$ to modify the approximation of atan to:
	\begin{align}
		z       &= \frac{2x-3}{2+3x} \label{formula_atan_8} \\
		atan(x) &= tan^{-1}\Big(\frac{3}{2}\Big) + (z - z \cdot R(z)) \nonumber \\
		&= atan1.5_{hi} - ((z \cdot R(z) - atan1.5_{lo}) - z) \label{formula_atan_9}
	\end{align}
	\item Otherwise (x >= $\frac{39}{16}$), use the identity $tan^{-1}(x) = \lim\limits_{n \rightarrow \infty}(tan^{-1}(n)) + tan^{-1}(\frac{-1}{x}) = \frac{\pi}{2} + tan^{-1}(-\frac{1}{x})$ to modify the approximation of atan to:
	\begin{align}
		z       &= -\frac{1}{x} \label{formula_atan_10} \\
		atan(x) &= \frac{\pi}{2} + (z - z \cdot R(z)) \nonumber \\
		&= atanInf_{hi} - ((z \cdot R(z) - atanInf_{lo}) - z) \label{formula_atan_11}
	\end{align}
	\item Return the result of the appropriate approximation, with the sign of the original input value.
	%TODO: We might need to find out why the specific values were chosen for the range reduction. The k=4*x+0.25 approach seems to want to have a new range every time 4*x+0.25 reaches a new specific integer (2, 3, 5, 10), could be because they are the highest integer values for which x falls below 0.5, 1, 1.5 and 2.
\end{compactenum}

\begin{figure}[H]
	\begin{sffamily}\small
		\begin{center}
			\begin{tabularx}{\dimexpr\textwidth-1\tabcolsep}{|c||c|c|c|c|c|c|c|}
				\hline
				$x$       & $-$Inf           & $<0$      & $-0$ & $+0$              & $>0$      & $+$Inf           & NaN \\ \hline
				$atan(x)$ & $-\frac{\pi}{2}$ & $atan(x)$ & \multicolumn{2}{c|}{$x$} & $atan(x)$ & $+\frac{\pi}{2}$ & NaN \\ \hline
				
				\caption{Outputs of atan}\label{tab:atan}
			\end{tabularx}
		\end{center}
	\end{sffamily}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.53\textwidth]{./figure/Atan_Flowchart.pdf}
	\caption{Flowchart atan}
	\label{fig:flowchart-atan}
\end{figure}